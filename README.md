# 太子のあした 🌅📸
**presented by NPO法人姫路YMCA**

iPhoneの写真アプリにインスパイアされた、太子町の子どもたちの笑顔あふれる未来を描くフォトマップアプリケーション。

## 🎯 プロジェクト概要

OpenStreetMapとLeafletを使用して、太子町の子どもたちの未来への希望と笑顔あふれる瞬間を地図上で探索できるWebアプリケーションです。「太子のあした」は、子どもたちが創る町の未来を表現し、iOS風のモダンなデザインと、直感的なユーザーインターフェースを特徴としています。

## ✨ 実装済み機能

### 🗺️ 地図機能
- **OpenStreetMap/Leaflet統合**: 高精度なマップ表示
- **カスタムSVGマーカー**: 写真数バッジ付きエリアマーカー
- **ズーム対応マーカーサイズ**: 数学的精度でのレスポンシブ表示
- **エリアベース写真クラスタリング**: 中心点と半径計算による効率的なグループ化

### 📱 ユーザーインターフェース
- **刷新されたヘッダーデザイン**: 左揃えタイトル + 右側運営団体リンク
- **新デザインタイトル**: 「ASOBO太子遊びと冒険の森のこれまで presented by NPO法人姫路YMCA」
- **運営団体リンク**: https://himeji-ymca.org/ への直接アクセス
- **iOS風デザイン**: 自動ダーク/ライトモード対応
- **3列グリッド表示**: 美しいアスペクト比保持の写真グリッド
- **タイムライン表示**: 日付グループ化された時系列ビュー（グレー系デザイン）
- **スムーズスクロール**: カスタムスクロールバーとオーバーフロー制御
- **レスポンシブレイアウト**: モバイル・デスクトップ対応

### 🖼️ 画像管理・フォールバック機能 ⭐NEW⭐
- **統合ImageHandler**: グリッド・タイムライン共通の画像処理システム
- **美しいフォールバック画像**: リンク切れ時の洗練されたSVG表示
- **ダークモード対応**: ライト・ダークテーマに適応するフォールバック画像
- **ローディング状態表示**: シマー効果によるローディングアニメーション
- **エラーログ出力**: 画像読み込み失敗の詳細ログ記録
- **遅延読み込み**: Intersection Observerによる効率的な画像読み込み

### 🔧 技術アーキテクチャ
- **ES6モジュール**: モジュラー設計による保守性向上
- **EventEmitterパターン**: 疎結合なモジュール間通信
- **統一エラーハンドリング**: ユーザーフレンドリーな通知システム
- **静的JSONデータ**: RESTful Table API代替の軽量データ管理

### 📸 写真詳細表示機能 ⭐NEW⭐
- **写真クリック機能**: グリッド・タイムライン両方で写真詳細表示
- **モーダルウィンドウ**: 美しい写真詳細モーダル
- **詳細情報表示**: タイトル、説明、撮影日、位置情報、タグ
- **ImageHandlerフォールバック**: モーダル内画像でも動作
- **マルチクローズ機能**: ✕ボタン、背景クリック、ESCキー対応

### 💬 感想収集機能 ⭐LATEST⭐
- **感想収集ボタン**: 写真追加ボタンを感想収集に変更
- **美しいダイアログ**: モダンなUI/UXでの感想フォーム案内
- **Googleフォーム連携**: 外部フォームでの感想収集
- **アニメーション効果**: ハートビートアニメーション付きボタン
- **感謝メッセージ**: フォーム開封後の感謝トースト表示

## 🚀 現在の動作確認済み機能

### マーカーとエリア表示
- ✅ 20エリアの地図マーカー表示
- ✅ 写真数バッジ付きカスタムSVGマーカー
- ✅ マーカークリックによるエリア情報表示
- ✅ ズームレベル対応マーカーサイズ調整

### 写真表示とインタラクション
- ✅ **写真クリック機能復旧完了** 🎉
- ✅ 写真詳細モーダル表示
- ✅ ImageHandlerフォールバック機能
- ✅ モーダルクローズ機能（複数方法対応）

### スクロール機能 ✅
- ✅ **グリッド表示スクロール**: 9枚以上の写真で確実にスクロール発生
- ✅ **タイムライン表示スクロール**: 日付グループ対応の縦スクロール
- ✅ **カスタムスクロールバー**: ライト/ダークモード対応の美しいスクロールバー

### 画像フォールバック機能 🆕 ✅
- ✅ **グリッド表示**: 画像読み込み失敗時の美しいフォールバック表示
- ✅ **タイムライン表示**: 統一されたフォールバック機能
- ✅ **ローディング状態**: シマー効果付きローディング表示
- ✅ **エラーハンドリング**: 詳細なエラーログとユーザーフレンドリーな代替表示

### デザイン改善 ✅
- ✅ **ヘッダー余白**: 特に下側余白を追加してゆとりあるレイアウト
- ✅ **グリッドホバー効果**: 写真ホバー時の日付・タイトルを純白表示（ライト・ダークモード対応）
- ✅ **タイムライン日付表示**: 青色からグレー系への変更で写真を主役に
- ✅ **写真枚数バッジ**: 控えめなグレー系デザイン
- ✅ **統一感のあるUI**: より洗練されたプロフェッショナルな外観

### シンプル化 🆕 ✅
- ✅ **機能削除**: 検索・ソート機能を削除してシンプルなUXに
- ✅ **コードクリーンアップ**: 不要なCSS・JavaScript・イベントハンドラーを削除
- ✅ **軽量化**: アプリケーションの軽量化とパフォーマンス向上
- ✅ **保守性向上**: コードベースの簡素化によるメンテナンス性向上

### 写真詳細表示機能の修復 🔧 ⭐NEW⭐
- ✅ **PHOTO_CLICKEDイベント**: EventBusへの適切なイベント定義追加
- ✅ **写真詳細モーダル**: クリック時の詳細表示機能を完全復旧
- ✅ **フォールバック対応**: モーダル内画像でもImageHandler使用
- ✅ **ESCキー対応**: キーボードショートカットでモーダルクローズ
- ✅ **モーダル操作**: 背景クリック・Xボタンでのクローズ機能

## 📊 現在のデータ構成

### 主要エリアと子どもたちの写真数
- **太子中央公園**: 公園で遊ぶ子どもたちの笑顔
- **太子スポーツ公園**: スポーツを楽しむ元気な子どもたち
- **太子アグリパーク**: 農業体験で学ぶ子どもたち
- **太子川河川公園**: 水遊びを楽しむ子どもたち
- **太子北部山林地帯**: 自然探検する子どもたち
- **太子東小学校区**: 運動会で頑張る子どもたち
- **太子里山保全区域**: 自然観察を楽しむ子どもたち

## 🔧 技術スタック

- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **地図ライブラリ**: Leaflet.js 1.9.4
- **マップタイル**: OpenStreetMap
- **アイコン**: Font Awesome 6.4.0
- **フォント**: Google Fonts (Inter)
- **アーキテクチャ**: モジュラー設計, EventEmitter Pattern
- **画像処理**: 独自ImageHandlerクラス

## 📁 プロジェクト構造

```
├── index.html              # メインHTML（新タイトル対応）
├── css/
│   └── style.css          # 統合スタイルシート（画像フォールバック対応）
├── js/
│   ├── app-refactored.js  # メインアプリケーション（ImageHandler統合）
│   ├── config/
│   │   └── constants.js   # 設定定数
│   ├── modules/
│   │   ├── DataManager.js # データ管理
│   │   ├── MapManager.js  # 地図管理
│   │   ├── MarkerManager.js # マーカー管理
│   │   └── UIManager.js   # UI管理
│   └── utils/
│       ├── ImageHandler.js # 🆕 画像処理・フォールバック
│       ├── EventEmitter.js # イベントシステム
│       └── ErrorHandler.js # エラーハンドリング
└── data/
    ├── photos.json        # 写真データ（22枚、テスト画像含む）
    └── areas.json         # エリアデータ（20エリア）
```

## 🎮 使用方法

1. **地図閲覧**: マウス/タッチで地図を移動・ズーム
2. **エリア選択**: マーカーをクリックしてエリア詳細を表示
3. **表示モード切り替え**: グリッド/タイムラインボタンで表示切り替え
4. **笑顔スクロール**: 多数の子どもたちの写真がある場合、コンテナ内でスクロール可能
5. **写真詳細**: 子どもたちの写真をクリックして詳細情報を表示
6. **フォールバック**: 画像読み込み失敗時の美しい代替表示

## 🔮 今後の推奨開発タスク

### 🎯 高優先度
1. **TypeScript移行**: 型安全性とコード品質向上
2. **写真追加機能**: 新しい写真のアップロードとGPS情報取得
3. **写真フィルタリング**: タグ、日付、エリアによる絞り込み
4. **パフォーマンス最適化**: 大量写真対応と遅延読み込み強化

### 🛠️ 中優先度
1. **写真編集機能**: 基本的な画像編集とフィルター
2. **共有機能**: ソーシャルメディア連携
3. **オフライン対応**: Service Workerによるキャッシュ機能
4. **アニメーション強化**: より滑らかな遷移とマイクロインタラクション

### 📈 低優先度
1. **多言語対応**: 国際化対応
2. **アクセシビリティ向上**: WCAG準拠
3. **PWA化**: ネイティブアプリ風の体験
4. **統計機能**: 閲覧数、人気エリア分析

## 🚨 既知の問題と制限事項

- **データ永続化**: 現在は静的JSONファイル使用（動的追加不可）
- **写真アップロード**: 未実装（将来的にRESTful API統合予定）
- **ユーザー認証**: 現在は未実装
- **リアルタイム同期**: 現在は静的データのみ

## 🎉 最新の更新（2024年8月）

### 🚀 パフォーマンス・アクセシビリティ大幅改善 ⭐NEW⭐
- **画像読み込みエラー対策**: ERR_BLOCKED_BY_ORB エラーを解決、代替URL自動試行機能
- **ページロード最適化**: 並列データ読み込み、CDNプリロード、モジュール事前読み込み
- **進捗表示改善**: 段階的ローディング、リアルタイム進捗バー、ステップ表示
- **モバイル体験向上**: タッチターゲット拡大、スムーズスクロール、GPU加速
- **アクセシビリティ強化**: ARIA属性、スクリーンリーダー対応、フォーカス管理
- **アナリティクス統合**: プライバシー重視の軽量統計・エラー追跡機能

### ヘッダー・タイトル刷新 ✨
- **新ヘッダーレイアウト**: 左揃えタイトル + 右側運営団体リンク
- **ヘッダー余白改善**: 特に下側の余白を拡充してゆとりあるデザイン
- **新タイトル**: 「ASOBO太子遊びと冒険の森のこれまで」
- **presented by NPO法人姫路YMCA**: 控えめで上品なサブタイトル表示
- **運営団体リンク**: 右上に「運営団体」ボタン（https://himeji-ymca.org/）
- **レスポンシブ対応**: モバイル・タブレット・デスクトップでの最適表示
- **外部リンク**: 新しいタブで安全に開く設定

### シンプル化による使いやすさ向上 ✨
- **検索・ソート機能削除**: よりシンプルで直感的なユーザー体験を重視
- **クリーンなインターフェース**: 余計な要素を排除したスッキリとしたデザイン
- **コードの最適化**: 不要な機能削除による軽量化とメンテナンス性向上
- **フォーカス**: 写真の美しさと地図上での発見体験に集中

### 画像フォールバック機能の完全実装 🖼️
- **共通ImageHandlerクラス**: グリッド・タイムライン両対応の統一システム
- **美しいフォールバック**: iOS風の洗練されたSVG代替画像
- **ローディング状態**: シマー効果による視覚的フィードバック
- **代替URL試行**: 複数のCDN・サイズを自動で試行
- **エラーログ**: 開発者向け詳細エラー情報出力

### デザイン最適化 🎨
- **タイムライン日付**: 青色 → グレー系で写真を主役に
- **写真枚数バッジ**: 控えめなグレー系デザイン
- **統一感**: より洗練されたプロフェッショナルな外観
- **高コントラスト対応**: アクセシビリティ強化
- **モーション軽減**: 動きに敏感なユーザーへの配慮

### 技術向上 ⚙️
- **ES6モジュール**: 最新のモジュール構造
- **エラーハンドリング**: 堅牢な例外処理システム
- **パフォーマンス**: 効率的な画像読み込みとメモリ管理
- **プログレッシブ読み込み**: 段階的なリソース読み込み
- **Analytics**: プライバシー重視の使用統計機能

---

**開発者**: AI Assistant  
**発注者**: NPO法人姫路YMCA  
**プロジェクト開始**: 2024年  
**最終更新**: 2024年8月28日  
**ライセンス**: MIT

🌟 「太子のあした」で、子どもたちの笑顔があふれる太子町の明るい未来を地図上で楽しく探索しましょう！

### 🌅 **「太子のあした」について**

「太子のあした」は、NPO法人姫路YMCAが提供する太子町の子どもたちのフォトマップアプリケーションです。子どもたちの笑顔あふれる日常の瞬間を通じて、町の希望ある未来を表現しています。

**コンセプト:**
- 🌅 **未来志向**: 子どもたちが創る太子町の明るい「あした」
- 😊 **笑顔の力**: 子どもたちの笑顔が地域の希望の源
- 🤝 **地域のつながり**: 町全体で子どもたちを育む温かいコミュニティ
- 🌱 **成長の記録**: 子どもたちの健やかな成長の軌跡